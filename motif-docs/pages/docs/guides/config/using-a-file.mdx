---
heading: Project Configuration
title: Using a self-maintained file (or files)
---

import { Collapse } from "@components/ui/collapse.mdx"
import { Spacer } from "@components/ui/spacer.mdx"
import { Image } from "@components/ui/image.mdx"
import { Note } from "@components/ui/note.mdx"

To use your own file, you'll need to create a compatiple JSON file and add it to the path you indicated in the configuration.

<Spacer />

<Note type="info">If you prefer Cue or Yaml, you can instead use flightcontrol.cue or flightcontrol.yaml.</Note>

Each git repo can have multiple `flightcontrol.json` files

Each `flightcontrol.json` corresponds to a single `Project` (as shown in the Flightcontrol dashboard)

Each `Project` can have multiple `Environment`'s

Each `Environment` can have multiple `Service`'s

## Top level `Project` Options

`environments: Environment[]`

- One or more environments in this project.
- Typically you’ll have a `production` environment and a `staging` environment

`envVariables: EnvVariables`

- Environment variables configured at the top level will be automatically inherited by all environments and services in the file.
- You can override a specific env variable inside any environment or service

## `EnvVariables`

Environment variables can be configured two ways

1. In the Flightcontrol dashboard under an environment’s settings
2. Via flightcontrol.json (values defined here will override ones set in the dashboard)
    - object, with one or more of the following types
        - **Static**
            - Format:  `"NAME": "<value>"`
            - Example: `"APP_ENV": "production"`
            - Static, hard coded value in flightcontrol.json
        - **From another service:**
            - Format:  ****`"NAME": {"fromService": {"id": "<serviceId>", value: "<value>"}}`
            - Example:  ****`"NAME": {"fromService": {"id": "db", value: "dbConnectionString"}}`
            - Supported values for `type: "rds"` services:
            `dbConnectionString, username, password, host, port`
            - Supported values for `type: "fargate"` and `type: "static"` services:

                `host` will include the service URL without protocol: `www.example.com`

                `origin` will include the service URL with protocol: `https://www.example.com`

        - **From Parameter Store:**
            - Format:  `"NAME": {"fromParameterStore": "<parameterStoreItemName>"}`
            - Example: `"STRIPE_API_KEY": {"fromParameterStore": "ACME_STRIPE_API_KEY"}`
            - Securely retrieve the value from [AWS Parameter Store](https://console.aws.amazon.com/systems-manager/parameters). Parameter Store is a free AWS service for securely storing secrets.
            - **Important: Your parameter store item must be in the same region as your service**
            - Screenshot of parameter store
                <Image rounded={true} border={true} src="https://res.cloudinary.com/djp21wtxm/image/upload/v1655164946/i1600x1708-omdv9rVjfGZZ_muha6h.png" />
        - **From Secrets Manager:**
            - Format: `"NAME": {"fromSecretsManager": "<arn:your-secret-arn>"}`
            - Example: `"STRIPE_API_KEY": {"fromSecretsManager": "arn:aws:secretsmanager:us-west-1:832786265645:secret:/stripe-y6uINZ"}`
            - Securely retrieve the value from [AWS Secrets Manager](https://console.aws.amazon.com/secretsmanager/home). Secrets Manager is a paid AWS service for securely storing secrets. It costs $0.40/secret/month
- We automatically provide you with the following environment variables:
    - `CI=true`
    - `PORT=<your service.port value>`
    - `NODE_ENV=production`
    - `RAILS_ENV=production`
    - `FORCE_COLOR=0`
    - `FC_GIT_COMMIT_SHA=<git commit sha of the deployment>`
    - `FC_GIT_BRANCH=<git branch of the deployment>`


## `Environment`

`id: string`

- Example: `"id": "production"`
- This is a string id that you create. We use it on each git push to match your config to your existing environment in AWS
- This should never be changed

`name: string`

- Example: `"name": "Production"`
- This is the name we use to display your environment in the Flightcontrol web dashboard

`region: string`

- Example: `"region": "us-west-2"`
- Supported values: [any valid aws region](https://awsregion.info/)
- This is the AWS region that all your services within this environment will be located
- Typically you want this to be close to your users.

`source: object`

- `branch: string`
    - Example: `"source": {"branch": "main"}`
    - The github branch you want deployed to this environment.
    - Every git push to this branch will be automatically deployed
- `trigger: string`
    - Example: `"trigger": "manual"`
    - Supported values: `"manual", "push"`
    - Optional with default to  `"push"`
    - Leaving the trigger as `”push”` will result in an automatic deployment of any git push to the branch. Changing the trigger to `"manual"` will prevent automatic deployments and require manually deploying the environment in the hamburger menu in the environment show page:
        <Image rounded={true} border={true} className="w-full max-w-[260px]" src="https://res.cloudinary.com/djp21wtxm/image/upload/v1655165043/i686x716-7i2z1btLjnel_ysjwps.png" />

`envVariables: EnvVariables`

- Environment variables configured at the environment level will be automatically inherited by all the services within this environment
- You can override a specific env variable inside a specific service

`services: Service[]`

- These services will be deployed and updated together.
- These services exist inside the same VPC (each environment has it’s own VPC)

### Deployment Hooks

- Deployment hooks are a way for you to trigger a deployment on an environment remotely with an HTTP request:
    - You must first create a deploy hook in the environment edit page accessed by clicking “Edit Environment” button on the project show page, and then locate the Deploy Hooks form in the UI.
    <Image rounded={true} border={true} className="w-full max-w-[260px]" src="https://res.cloudinary.com/djp21wtxm/image/upload/v1655165074/i448x132-1xpvO1Oe_clb_dfdluu.png" />
    <Image rounded={true} border={true} className="w-full" src="https://res.cloudinary.com/djp21wtxm/image/upload/v1655165094/i1600x518-RjDe674AMVxY_lh4txx.png" />
    - To trigger a deployment with this hook, make a HTTP GET request at this url (no payload is necessary).

## `Service`

`id: string`

- Example: `"id": "production-web"`
- This is a string id that you create. We use it on each git push to match your config to your existing service in AWS
- This should never be changed

`name: string`

- Example: `"name": "Production Web"`
- This is the name we use to display your service in the Flightcontrol web dashboard

`envVariables: EnvVariables`

`type: 'fargate'` (web server)

<Collapse title="Fargate service options">
    `cpu: number`

    - Example: `"cpu": 0.25`
    - Supported values: `0.25, 0.5, 1, 2, 4`
    - This is the AWS `vCPU` unit for each service instance. It does not correspond to number of cores. It’s an abstract unit of CPU power defined by amazon
    - For more details, see [AWS’s fargate pricing page](https://aws.amazon.com/fargate/pricing/)

    `memory: int`

    - Example: `"memory": 1`
    - Supported values:
        - With `cpu: 0.25` - `0.5, 1, 2`
        - With `cpu: 0.5` - `1...4` (*int)*
        - With `cpu: 1` - `2...8` (*int)*
        - With `cpu: 2` - `4...16` (*int)*
        - With `cpu: 4` - `8...30` (*int)*
    - Memory can be in GB or MB for each service instance
        -
    - For more details, see [AWS’s fargate pricing page](https://aws.amazon.com/fargate/pricing/)

    `minInstances: int`

    - Example: `"minInstances": 1`
    - Support values: `1+`
    - Optional with default: `1`
    - The minimum number of instances you want to be running. A min of 2 means there will be two containers running the same copy of code.

    `maxInstances: int`

    - Example: `"maxInstances": 2`
    - Support values: `1+`
    - Optional with default: `1`
    - The maximum number of instances you want to be running. Fargate will autoscale the number of instances based on your traffic up to this maximum. This number effectively sets a limit on AWS cost you may incur.

    `domain: string`

    - Example: `"domain": "www.example.com"`
    - Optional, defaults to a random url like `123456789.cloudfront.net`
    - Wildcard domains are supported: `"domain": "*.example.com"` The http `host` header will contain the specific domain that’s being used.
    - If configured, during the setup phase in the Flightcontrol dashboard we’ll show you the required DNS changes to actually point your custom domain to this service. If you configure the domain here but don’t change your DNS, you can still access the service using the random generated `[x.cloudfront.net](http://x.cloudfront.net)` domain.
        - *Example screenshot*
            <Image rounded={true} border={true} src="https://res.cloudinary.com/djp21wtxm/image/upload/v1655165403/i1600x349-REQhW6PMBk1__xncshv.png" />

    `healthCheckPath: string`

    - Example: `"healthCheckPath": "/health"`
    - Optional with default: `"/"`
    - HTTP status codes that signal healthy: `200-399`
    - This is used during deployment to ensure the server is healthy before traffic is routed to it. And during runtime, to automatically replace unhealthy servers. If you notice that your app is in a cycle of working and not working, it could be your health check path is returning an error causing the to keep restarting your server.

    <Collapse title="Extra options for Node.js only">
        `port: number`

        - Example: `"port": 8080`
        - Optional with default: `3000`
        - The http port we’ll direct incoming traffic to

        `installCommand: string`

        - Example: `"installCommand": "./install.sh"`
        - Optional with default:
            - If you have `yarn.lock` ,  `yarn install --frozen-lockfile --production=false`
            - If you have `pnpm-lock.yaml` ,  `pnpm install --frozen-lockfile --prod=false`
            - Else  `npm ci --production=false`
        - What we use to install dependencies for your build

        `buildCommand: string`

        - Example: `"buildCommand": "blitz build"`
        - Optional with default:
            - If you have `yarn.lock` ,  `yarn build`
            - If you have `pnpm-lock.yaml` ,  `pnpm build`
            - Else  `npm run build`
        - What we use to build your app

        `postBuildCommand: string`

        - Example: `"postBuildCommand": "npm run cleanup"`
        - Optional with default:
            - If you have `yarn.lock` ,  `yarn install --production --frozen-lockfile --force`
            - If you have `pnpm-lock.yaml` ,  `pnpm prune --production --frozen-lockfile`
            - Else  `npm prune --production`
        - What we use to clean to remove all development dependencies before starting your app. This reduces the build image size and improves security by minimizing the attack surface area.

        `startCommand: string`

        - Example: `"startCommand": "blitz start"`
        - Optional with default:
            - If you have `yarn.lock` ,  `yarn start`
            - If you have `pnpm-lock.yaml` ,  `pnpm start`
            - Else  `npm run start`
        - What we use to start your app
    </Collapse>
    <Collapse title="Extra options for custom Dockerfile only">
        `port: number`

        - Example: `"port": 8080`
        - The http port we’ll direct incoming traffic to
        - We automatically set the `PORT` environment variable to whatever you configure here

        `dockerfilePath: string`

        - Example: `"dockerfilePath": "packages/web/Dockerfile"`
        - Relative path to the Dockerfile from your repo root
        - It’s recommended to use `ENTRYPOINT` instead of `CMD` for your start command
        - You can authenticate with Docker Hub by adding your Docker Hub credentials as `DOCKER_USERNAME` and `DOCKER_PASSWORD` environment variables. If these env variables are present, we’ll run `docker login` with them. *This will prevent Docker Hub rate limit issues.*

        `dockerContext: string`

        - Example: `"dockerContext": "packages/web"`
        - Optional with default: `"."` (repo root)
        - Relative path to the docker context from the repo root
        - It’s recommended to use `ENTRYPOINT` instead of `CMD` for your start command
    </Collapse>
</Collapse>

`type: 'static'` (static website)

<Collapse title="Static service options">
`domain: string`

- Example: `"domain": "www.example.com"`
- Optional, defaults to a random url like `123456789.cloudfront.net`
- Wildcard domains are supported: `"domain": "*.example.com"` The http `host` header will contain the specific domain that’s being used.
- If configured, during the setup phase in the Flightcontrol dashboard we’ll show you the required DNS changes to actually point your custom domain to this service. If you configure the domain here but don’t change your DNS, you can still access the service using the random generated `[x.cloudfront.net](http://x.cloudfront.net)` domain.
    - *Example screenshot*

        <Image rounded={true} border={true} src="https://res.cloudinary.com/djp21wtxm/image/upload/v1655165922/i1600x349-0NhJiulDrUvt_aymzp2.png" />

`singlePageApp: boolean`

- Example: `"singlePageApp": true`
- Optional with default: `false`
- When true, all routes will load your root `/` page.
- This should be enabled for sites like create-react-app and redwood, but not for static site generators like Next.js, Gatsby, etc.

`installCommand: string`

- Example: `"installCommand": "./install.sh"`
- Optional with default:
    - If you have `yarn.lock` ,  `yarn install --frozen-lockfile --production=false`
    - If you have `pnpm-lock.yaml` ,  `pnpm install --frozen-lockfile --prod=false`
    - Else  `npm ci --production=false`
- What we use to install dependencies for your build

`buildCommand: string`

- Example: `"buildCommand": "blitz build"`
- Optional with default:
    - If you have `yarn.lock` ,  `yarn build`
    - If you have `pnpm-lock.yaml` ,  `pnpm build`
    - Else  `npm run build`
- What we use to build your app

`outputDirectory: string`

- Example: `"outputDirectory": "web/dist"`
- Optional with default: `"public"`
- All the files in this directory will be served statically via the Cloudfront CDN
</Collapse>

`type: 'rds'` (database)

<Collapse title="RDS service options">

    `engine: string`

    - Example: `"engine": "postgres"`
    - Supported values: `"postgres", "mysql", "mariadb"`

    `engineVersion: string`

    - Example: `"engineVersion": "12"`
    - Supported values:
        - Postgres: `9, 10, 11, 12, 13, 14` (NOTE: Only versions 9-12 have a free tier)
        - Mysql: `5.6, 5.7, 8`
        - Mariadb: `10.2, 10.3, 10.4, 10.5, 10.6`
    - Changing this will initiate a database upgrade. The database will be updated in the next scheduled maintenance window unless you set `applyChangesImmediately: true`

    `autoUpgradeMinorVersions: boolean`

    - Example: `“autoUpgradeMinorVersions": true`
    - Optional with default: `true`

    `instanceSize: string`

    - Example: `"instanceSize": "db.t2.micro"`
    - Support values: [See the AWS documentation](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Concepts.DBInstanceClass.html)
    - Changing this will initiate a database upgrade. The database will be updated in the next scheduled maintenance window unless you set `applyChangesImmediately: true`

    `storage: int`

    - Example: `"storage": 20`
    - Support values: `20-65,536`
    - When increasing storage, AWS will automaticaly upgrade it by 20% if you increase the value less than 20
    - Changing this will initiate a database upgrade. The database will be updated in the next scheduled maintenance window unless you set `applyChangesImmediately: true`

    `maxStorage: string`

    - Example: `"maxStorage": 40`
    - Optional
    - Support values: `20-65,536`
    - For detailed autoscaling info, see [the AWS autoscaling docs](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_PIOPS.StorageTypes.html#USER_PIOPS.Autoscaling)

    `private: boolean`

    - Example: `"private": true`
    - Supported values: `false` (Private database support is planned. We’ll prioritize based on you telling us it’s a requirement for you)
    - Private means the database is not accessible from the internet. Public means it is. However, the database is fully secured when public, but it just allows attackers to try and brute force the secure credentials. Or try to find some vulnerability.

    `deletionProtection: boolean`

    - Example: `"deletionProtection": true`
    - Optional with default: `false`
    - Enabling this will prevent any user from deleting the database until it is changed
    - It’s recommended to enable this for production databases.

    `port: int`

    - Example: `"port": 1234`
    - Optional with default:
        - Postgres: `5432`
        - Mysql: `3306`
        - Mariadb: `3306`

    <Collapse title="Extra options for Node.js only">

    `port: number`

    - Example: `"port": 8080`
    - Optional with default: `3000`
    - The http port we’ll direct incoming traffic to

    `installCommand: string`

    - Example: `"installCommand": "./install.sh"`
    - Optional with default:
        - If you have `yarn.lock` ,  `yarn install --frozen-lockfile --production=false`
        - If you have `pnpm-lock.yaml` ,  `pnpm install --frozen-lockfile --prod=false`
        - Else  `npm ci --production=false`
    - What we use to install dependencies for your build

    `buildCommand: string`

    - Example: `"buildCommand": "blitz build"`
    - Optional with default:
        - If you have `yarn.lock` ,  `yarn build`
        - If you have `pnpm-lock.yaml` ,  `pnpm build`
        - Else  `npm run build`
    - What we use to build your app

    `postBuildCommand: string`

    - Example: `"postBuildCommand": "npm run cleanup"`
    - Optional with default:
        - If you have `yarn.lock` ,  `yarn install --production --force`
        - If you have `pnpm-lock.yaml` ,  `pnpm prune --production`
        - Else  `npm prune --production`
    - What we use to clean to remove all development dependencies before starting your app. This reduces the build image size and improves security by minimizing the attack surface area.

    `startCommand: string`

    - Example: `"startCommand": "blitz start"`
    - Optional with default:
        - If you have `yarn.lock` ,  `yarn start`
        - If you have `pnpm-lock.yaml` ,  `pnpm start`
        - Else  `npm run start`
    - What we use to start your app

    </Collapse>

    <Collapse title="Extra options for custom Dockerfile only">
    `port: number`

    - Example: `"port": 8080`
    - The http port we’ll direct incoming traffic to
    - We automatically set the `PORT` environment variable to whatever you configure here

    `dockerfilePath: string`

    - Example: `"dockerfilePath": "packages/web/Dockerfile"`
    - Relative path to the Dockerfile from your repo root
    - It’s recommended to use `ENTRYPOINT` instead of `CMD` for your start command
    - You can authenticate with Docker Hub by adding your Docker Hub credentials as `DOCKER_USERNAME` and `DOCKER_PASSWORD` environment variables. If these env variables are present, we’ll run `docker login` with them. *This will prevent Docker Hub rate limit issues.*

    `dockerContext: string`

    - Example: `"dockerContext": "packages/web"`
    - Optional with default: `"."` (repo root)
    - Relative path to the docker context from the repo root
    - It’s recommended to use `ENTRYPOINT` instead of `CMD` for your start command
    </Collapse>
</Collapse>