---
heading: Configuration
title: Monorepo Setup
---

## Configuration File

You can place the config file at the root of your repository and use it to configure each Flightcontrol service. See below some guidance on how to configure them.

## Using `buildType: nixpacks`

There are different types of monorepos and tooling around it. Your configuration will depend on those.
We cover a few cases below.

### Independent packages in a repo

If you don't use any sort of monorepo tooling at the root of your repo, then you should indicate a `basePath` alongside the `[install|build|start]` commands, like illustrated in the contrived config example below.

```diff
{
  "environments": [
    {
      "id": "development",
      "name": "Development",
      "region": "us-east-2",
      "source": {
        "branch": "main"
      },
      "services": [
        {
          "id": "api",
          "name": "Backend API",
          "type": "fargate",
          "buildType": "nixpacks",
          "basePath": "./packages/api",
          "healthCheckPath": "/graphql/health",
          "installCommand": "pnpm i"
          "buildCommand": "pnpm build",
          "startCommand": "pnpm start",
        },
        {
          "id": "frontend",
          "name": "Frontend Web",
          "type": "static",
          "singlePageApp": true,
          "basePath": "./packages/frontend",
          "installCommand": "pnpm i"
          "buildCommand": "pnpm build",
          "startCommand": "pnpm start",
          "outputDirectory": "web/dist",
        }
      ]
    }
  ]
}
```

### Packages managed with monorepo tooling

For JS monorepo that use `npm` and/or require installation at the root, you'll likely need to manually specify the install/build command AND account for the right path by `cd`'ing to the corresponding package, like so:

```json
{
  "environments": [
    {
      ...
      "services": [
        {
          "id": "api",
          "buildType": "nixpacks",

          "installCommand": "npm i && cd packages/api && npm i"
          "buildCommand": "cd packages/api && npm run build",
          "startCommand": "cd packages/api && npm run start",

          "basePath": ".",       // This is the default, no need to include it.
                                    Left for illustration purpose
          ...

        },
        ...
      ]
    }
  ]
}
```

If you have a nx package-based monorepo, then you'll need to specify the `nx` command, including the package name, but you should not change the `basePath`:

```json
{
  "environments": [
    {
      ...
      "services": [
        {
          "id": "api",
          "buildType": "nixpacks",
          "buildCommand": "nx build blog",
          "startCommand": "nx serve blog --verbose",
          ...
        },
        ...
      ]
    }
  ]
}
```

### Further customization

If there are specific needs for building/installing a service, such as custom phases or specific OS packages, then you can use a `nixpacks.toml`.

The `.toml` file is specific to each package and should be placed in the package's folder.

If you're using `basePath` in your flightcontrol configuration, you don't need to do anything else and the file will be picked up.

If you're not using it, you'll need to set a `NIXPACKS_CONFIG_FILE` environment variable to the service's `nixpacks.toml` file path.

```json
{
  id: "production",
  name: "production",
  services: [
    {
      id: "frontend",
      buildType: "nixpacks",
      envVariables": {
        "NIXPACKS_CONFIG_FILE": "./apps/frontend/nixpacks.toml"
      }
      ...
    },
    {
      id: "api",
      buildType: "nixpacks",
      envVariables": {
        "NIXPACKS_CONFIG_FILE": "./packages/api/nixpacks.toml"
      }
      ...
    },
  ],
}
```
