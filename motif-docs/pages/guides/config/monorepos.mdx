---
heading: Configuration
title: Monorepo Setup
---

## Configuration File

You can place the config file at the root of your repository and use it to configure each Flightcontrol service. See below some guidance on how to configure them.

## Using `buildType: nixpacks`

There are different types of monorepos and tooling around it. Your configuration will depend on those.
We cover a few cases below.

### Independent packages in a repo

You should indicate a `basePath` alongside the `[install|build|start]` commands for each service, like illustrated in the contrived config example below.

```diff
{
  "environments": [
    {
      "id": "development",
      "name": "Development",
      "region": "us-east-2",
      "source": {
        "branch": "main"
      },
      "services": [
        {
          "id": "api",
          "name": "Backend API",
          "type": "fargate",
          "buildType": "nixpacks",
          "basePath": "./packages/api",
          "healthCheckPath": "/graphql/health",
          "installCommand": "pnpm i"
          "buildCommand": "pnpm build",
          "startCommand": "pnpm start",
        },
        {
          "id": "frontend",
          "name": "Frontend Web",
          "type": "static",
          "singlePageApp": true,
          "basePath": "./packages/frontend",
          "installCommand": "pnpm i"
          "buildCommand": "pnpm build",
          "startCommand": "pnpm start",
          "outputDirectory": "web/dist",
        }
      ]
    }
  ]
}
```

### Packages managed with monorepo tooling

For a JS monorepo using `npm` or a monorepo that requires running command from the root, you'll need to manually specify the install/build command AND account for the right path depending on the command needed, like so:

```json
{
  "environments": [
    {
      ...
      "services": [
        {
          "id": "api",
          "buildType": "nixpacks",


          "basePath": "./packages/api",
          "installCommand": "cd .. && npm ci"
          "startCommand": "npm run start",
          "buildCommand": "npm run build",
          ...

        },
        ...
      ]
    }
  ]
}
```

If you have a nx package-based monorepo, then you'll need to specify the `nx` command, including the package name, but you should not include or change the `basePath`:

```json
{
  "environments": [
    {
      ...
      "services": [
        {
          "id": "api",
          "buildType": "nixpacks",
          "buildCommand": "nx build blog",
          "startCommand": "nx serve blog --verbose",
          ...
        },
        ...
      ]
    }
  ]
}
```

### Further customization

If there are specific needs for building/installing your service, such as custom phases or specific OS packages, then you can use a `nixpacks.toml`.
The `.toml` file is specific to each package and should be placed in the package's folder.

If you're using `basePath` in your flightcontrol configuration, you don't need to do anything else and the file will be picked up.

If you're not using it, you'll need to set a `NIXPACKS_CONFIG_FILE` environment variable to the service's `nixpacks.toml` file path, like so:

```json
{
  id: "production",
  name: "production",
  services: [
    {
      id: "frontend",
      buildType: "nixpacks",
      envVariables": {
        "NIXPACKS_CONFIG_FILE": "./apps/frontend/nixpacks.toml"
      }
      ...
    },
    {
      id: "api",
      buildType: "nixpacks",
      envVariables": {
        "NIXPACKS_CONFIG_FILE": "./packages/api/nixpacks.toml"
      }
      ...
    },
  ],
}
```
